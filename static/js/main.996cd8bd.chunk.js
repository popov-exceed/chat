(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{334:function(e,t,n){},335:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(21),s=n.n(a),o=(n(202),n(41)),i=n(60),u=n(25),l="SING_IN",j="LOGOUT",d={user:localStorage.getItem("User")?JSON.parse(localStorage.getItem("User")):null,token:localStorage.getItem("Token")};var b=n(174),O=n(112),m={list:[]};var h={list:[]};var f=n(175),x=Object(i.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0,n=t.payload,c=t.type;switch(c){case l:return Object(u.a)(Object(u.a)({},e),{},{user:n.user,token:n.token});case j:return{user:null,token:""};default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0,n=t.payload,c=t.type;switch(c){case"GET_MESSAGES":return Object(u.a)(Object(u.a)({},e),{},{list:n.messages});case"NEW_MESSAGE":return Object(u.a)(Object(u.a)({},e),{},{list:[].concat(Object(O.a)(e.list),[n.message])});case"READ_MESSAGE":return Object(u.a)(Object(u.a)({},e),{},{list:e.list.map((function(e){return e._id===n.messageId?Object.assign({},e,{read:!0}):e}))});default:return e}},onlineUsers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0,n=t.payload,c=t.type;switch(c){case"GET_USERS":return Object(u.a)(Object(u.a)({},e),{},{list:n.users});case"NEW_USER":return e.list.find((function(e){return e._id==n.user.id}))?e:Object(u.a)(Object(u.a)({},e),{},{list:[].concat(Object(O.a)(e.list),[n.user])});case"LEAVE_USER":return Object(u.a)(Object(u.a)({},e),{},{list:e.list.slice().filter((function(e){return e._id!==n.user.id}))});default:return e}}}),p=Object(i.createStore)(x,Object(f.composeWithDevTools)(Object(i.applyMiddleware)(b.a))),g=n(97),y=n(24),S=n(85),v=n(342),k=n(339),E=n(337),I=n(341),_=n(194),w=n(7);var T=function(e){return function(t){var n=Object(o.c)((function(e){return e.auth.token}));return Object(w.jsx)(w.Fragment,{children:n?Object(w.jsx)(e,Object(u.a)({},t)):Object(w.jsx)(y.a,{exact:!0,to:"/login"})})}},N=n(176),U=n(177),F=n(178),G=n.n(F),M=function(){function e(){Object(N.a)(this,e)}return Object(U.a)(e,[{key:"connect",value:function(e,t){var n=this;return this.socket=G()("http://localhost:8000",{auth:{token:p.getState().auth.token}}),new Promise((function(c,r){return n.socket.on("connect",(function(){e(),c()})),n.socket.on("connect_error",(function(e){return r(e)})),new Promise((function(e,c){n.socket.on("disconnect",(function(){t(),e()}))}))}))}},{key:"disconnect",value:function(){var e=this;return new Promise((function(t){e.socket.disconnect((function(){e.socket=null,t()}))}))}},{key:"emit",value:function(e,t){var n=this;return new Promise((function(c,r){return n.socket?n.socket.emit(e,t,(function(e){return e.error?(console.error(e.error),r(e.error)):c()})):r("No socket connection.")}))}},{key:"on",value:function(e,t){var n=this;return new Promise((function(c,r){if(!n.socket)return r("No socket connection.");n.socket.on(e,t),c()}))}}]),e}(),A=n(179),R=n.n(A).a.create({responseType:"json",baseURL:"http://localhost:8000"}),B=function(e){return R.post("/login",{name:e})},L=n(343),P=n(345),C=n(136),W=n(113),J=n(180),D=n.n(J),H=k.a.Text,V=k.a.Paragraph;function q(e){var t=e.date,n=e.author,c=e.content,r=e.read,a=e.video;return Object(w.jsxs)(E.b.Item,{children:[Object(w.jsx)(E.b.Item.Meta,{avatar:Object(w.jsx)(I.a,{style:{backgroundColor:"#87d068"},icon:Object(w.jsx)(L.a,{})}),title:Object(w.jsx)(H,{strong:!0,children:n.name}),description:a?Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(V,{children:c}),Object(w.jsx)("iframe",{id:"ytplayer",type:"text/html",width:"640",height:"360",src:"https://www.youtube.com/embed/".concat(a),frameBorder:"0"})]}):Object(w.jsx)(V,{children:c})}),Object(w.jsx)(E.b.Item,{children:D()(t).format("HH:mm")}),Object(w.jsx)(E.b.Item,{children:r&&Object(w.jsx)(W.a,{style:{marginLeft:"10px"}})})]})}var z=n(338),Y=n(340),K=n(344);function Q(e){var t=e.socket,n=e.disabledSend,c=z.a.useForm(),r=Object(S.a)(c,1)[0];return Object(w.jsx)(z.a,{name:"name",form:r,onFinish:function(e){t.emit("new message",{content:e.message}),r.resetFields()},children:Object(w.jsx)(z.a.Item,{name:"message",rules:[{required:!0,message:"Please input your message!"}],children:Object(w.jsx)(Y.a,{size:"large",placeholder:"Enter a new message...",suffix:Object(w.jsx)(_.a,{type:"primary",htmlType:"submit",icon:Object(w.jsx)(K.a,{}),disabled:n}),style:{height:"8vh"},type:"textarea"})})})}var X=v.a.Content,Z=v.a.Footer,$=v.a.Sider,ee=k.a.Text,te=k.a.Title,ne={textInSideBar:{color:"#FFFFFF"},buttonInSideBar:{margin:"30px 10px"}},ce=new M;var re=T((function(){var e=Object(o.b)(),t=Object(c.useState)(!0),n=Object(S.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(!1),i=Object(S.a)(s,2),u=i[0],l=i[1],d=Object(o.c)((function(e){return e.messages.list})),b=Object(o.c)((function(e){return e.auth.user})),O=Object(o.c)((function(e){return e.onlineUsers.list}));return Object(c.useEffect)((function(){return ce.connect((function(){return a(!1)}),(function(){return a(!0)})).catch((function(e){return console.log(e.message)})),ce.on("connected",(function(t){var n=t.onlineUsers,c=t.lastsMessages;e({type:"GET_USERS",payload:{users:n}}),c.filter((function(e){return!e.read})).forEach((function(e){b._id!==e.author._id&&ce.emit("read message",e._id)})),e({type:"GET_MESSAGES",payload:{messages:c}}),C.animateScroll.scrollToBottom({containerId:"chat"})})),ce.on("new message",(function(t){e({type:"NEW_MESSAGE",payload:{message:t}}),C.animateScroll.scrollToBottom({containerId:"chat"}),b._id!==t.author._id&&ce.emit("read message",t._id)})),ce.on("new user",(function(t){return e({type:"NEW_USER",payload:{user:t}})})),ce.on("read message",(function(t){return e({type:"READ_MESSAGE",payload:{messageId:t}})})),ce.on("user exit",(function(t){return e({type:"LEAVE_USER",payload:{user:t}})})),function(){return ce.disconnect()}}),[]),Object(w.jsxs)("div",{style:{display:"flex",height:"100%"},children:[Object(w.jsx)(v.a,{style:{flexGrow:0},children:Object(w.jsxs)($,{collapsible:!0,onCollapse:function(e){return l(e)},children:[Object(w.jsx)(_.a,{onClick:function(){e((function(e){e({type:j}),localStorage.clear()})),ce.disconnect()},shape:"circle",icon:Object(w.jsx)(P.a,{}),style:ne.buttonInSideBar}),!u&&Object(w.jsx)(te,{level:5,style:ne.textInSideBar,children:"Online users:"}),Object(w.jsx)(E.b,{style:{paddingLeft:"20px"},split:!1,renderItem:function(e){return Object(w.jsx)(E.b.Item,{children:Object(w.jsx)(E.b.Item.Meta,{avatar:Object(w.jsx)(I.a,{style:{backgroundColor:"#87d068"},icon:Object(w.jsx)(L.a,{})}),title:!u&&Object(w.jsx)(ee,{style:ne.textInSideBar,strong:!0,children:e.name})})})},dataSource:O})]})}),Object(w.jsxs)(v.a,{style:{paddingLeft:"30px"},children:[Object(w.jsx)(X,{children:Object(w.jsx)(E.b,{id:"chat",style:{maxHeight:"85vh",overflowY:"scroll"},renderItem:function(e){return Object(w.jsx)(q,{date:e.date,video:e.video?e.video:null,author:e.author,content:e.content,read:e.read})},dataSource:d,locale:{emptyText:r?"Not connection":"Not messages"}})}),Object(w.jsx)(Z,{children:Object(w.jsx)(Q,{socket:ce,disabledSend:r})})]})]})}));var ae=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.auth.token}));return Object(w.jsxs)(v.a,{children:[Object(w.jsxs)(z.a,{name:"name",onFinish:function(t){var n=t.userName;e(function(e){return function(t){B(e).then((function(e){t({type:l,payload:{token:e.data.token,user:e.data.user}}),localStorage.setItem("Token",e.data.token),localStorage.setItem("User",JSON.stringify(e.data.user))}))}}(n))},children:[Object(w.jsx)(z.a.Item,{label:"User name",name:"userName",children:Object(w.jsx)(Y.a,{})}),Object(w.jsx)(z.a.Item,{children:Object(w.jsx)(_.a,{type:"primary",htmlType:"submit",children:"Sing in"})})]}),t&&Object(w.jsx)(y.a,{to:"/"})]})};n(334);var se=function(){return Object(w.jsx)("div",{className:"app",children:Object(w.jsxs)(g.a,{basename:"/",children:[Object(w.jsx)(y.b,{exact:!0,path:"/",component:re}),Object(w.jsx)(y.b,{path:"/login",component:ae})]})})};s.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(o.a,{store:p,children:Object(w.jsx)(se,{})})}),document.getElementById("root"))}},[[335,1,2]]]);
//# sourceMappingURL=main.996cd8bd.chunk.js.map
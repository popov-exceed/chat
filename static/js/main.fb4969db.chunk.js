(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{339:function(e,t,n){},340:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(21),s=n.n(a),o=(n(207),n(37)),i=n(60),u=n(25),l="SING_IN",j="LOGOUT",d={user:localStorage.getItem("User")?JSON.parse(localStorage.getItem("User")):null,token:localStorage.getItem("Token"),error:null};var b=n(179),O=n(115),m={list:[]};var h={list:[]};var f=n(180),p=Object(i.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0,n=t.payload,r=t.type;switch(r){case l:return Object(u.a)(Object(u.a)({},e),{},{user:n.user,token:n.token});case j:return{user:null,token:""};case"ERROR":return Object(u.a)(Object(u.a)({},e),{},{error:n.error});default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0,n=t.payload,r=t.type;switch(r){case"GET_MESSAGES":return Object(u.a)(Object(u.a)({},e),{},{list:n.messages});case"NEW_MESSAGE":return Object(u.a)(Object(u.a)({},e),{},{list:[].concat(Object(O.a)(e.list),[n.message])});case"READ_MESSAGE":return Object(u.a)(Object(u.a)({},e),{},{list:e.list.map((function(e){return e._id===n.messageId?Object.assign({},e,{read:!0}):e}))});default:return e}},onlineUsers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0,n=t.payload,r=t.type;switch(r){case"GET_USERS":return Object(u.a)(Object(u.a)({},e),{},{list:n.users});case"NEW_USER":return e.list.find((function(e){return e._id==n.user.id}))?e:Object(u.a)(Object(u.a)({},e),{},{list:[].concat(Object(O.a)(e.list),[n.user])});case"LEAVE_USER":return Object(u.a)(Object(u.a)({},e),{},{list:e.list.slice().filter((function(e){return e._id!==n.user.id}))});default:return e}}}),x=Object(i.createStore)(p,Object(f.composeWithDevTools)(Object(i.applyMiddleware)(b.a))),g=n(100),y=n(24),v=n(88),S=n(347),k=n(344),E=n(342),I=n(346),w=n(199),_=n(7);var T=function(e){return function(t){var n=Object(o.c)((function(e){return e.auth.token}));return Object(_.jsx)(_.Fragment,{children:n?Object(_.jsx)(e,Object(u.a)({},t)):Object(_.jsx)(y.a,{exact:!0,to:"/login"})})}},R=n(181),N=n(182),U=n(183),F=n.n(U),G=function(){function e(){Object(R.a)(this,e)}return Object(N.a)(e,[{key:"connect",value:function(e,t){var n=this;return this.socket=F()("https://charpopov.herokuapp.com/",{auth:{token:x.getState().auth.token}}),new Promise((function(r,c){return n.socket.on("connect",(function(){e(),r()})),n.socket.on("connect_error",(function(e){return c(e)})),new Promise((function(e,r){n.socket.on("disconnect",(function(){t(),e()}))}))}))}},{key:"disconnect",value:function(){var e=this;return new Promise((function(t){e.socket.disconnect((function(){e.socket=null,t()}))}))}},{key:"emit",value:function(e,t){var n=this;return new Promise((function(r,c){return n.socket?n.socket.emit(e,t,(function(e){return e.error?(console.error(e.error),c(e.error)):r()})):c("No socket connection.")}))}},{key:"on",value:function(e,t){var n=this;return new Promise((function(r,c){if(!n.socket)return c("No socket connection.");n.socket.on(e,t),r()}))}}]),e}(),M=n(184),A=n.n(M).a.create({responseType:"json",baseURL:"https://charpopov.herokuapp.com/"}),B=function(e){return A.post("/login",{name:e})},L=n(349),P=n(351),C=n(141),W=n(116),J=n(185),D=n.n(J),H=k.a.Text,V=k.a.Paragraph;function q(e){var t=e.date,n=e.author,r=e.content,c=e.read,a=e.video;return Object(_.jsxs)(E.b.Item,{children:[Object(_.jsx)(E.b.Item.Meta,{avatar:Object(_.jsx)(I.a,{style:{backgroundColor:"#87d068"},icon:Object(_.jsx)(L.a,{})}),title:Object(_.jsx)(H,{strong:!0,children:n.name}),description:a?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(V,{children:r}),Object(_.jsx)("iframe",{id:"ytplayer",type:"text/html",width:"640",height:"360",src:"https://www.youtube.com/embed/".concat(a),frameBorder:"0"})]}):Object(_.jsx)(V,{children:r})}),Object(_.jsx)(E.b.Item,{children:D()(t).format("HH:mm")}),Object(_.jsx)(E.b.Item,{children:c&&Object(_.jsx)(W.a,{style:{marginLeft:"10px"}})})]})}var z=n(343),Y=n(345),K=n(350);function Q(e){var t=e.socket,n=e.disabledSend,r=z.a.useForm(),c=Object(v.a)(r,1)[0];return Object(_.jsx)(z.a,{name:"name",form:c,onFinish:function(e){t.emit("new message",{content:e.message}),c.resetFields()},children:Object(_.jsx)(z.a.Item,{name:"message",rules:[{required:!0,message:"Please input your message!"}],children:Object(_.jsx)(Y.a,{size:"large",placeholder:"Enter a new message...",suffix:Object(_.jsx)(w.a,{type:"primary",htmlType:"submit",icon:Object(_.jsx)(K.a,{}),disabled:n}),style:{height:"8vh"},type:"textarea"})})})}var X=S.a.Content,Z=S.a.Footer,$=S.a.Sider,ee=k.a.Text,te=k.a.Title,ne={textInSideBar:{color:"#FFFFFF"},buttonInSideBar:{margin:"30px 10px"}},re=new G;var ce=T((function(){var e=Object(o.b)(),t=Object(r.useState)(!0),n=Object(v.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(!1),i=Object(v.a)(s,2),u=i[0],l=i[1],d=Object(o.c)((function(e){return e.messages.list})),b=Object(o.c)((function(e){return e.auth.user})),O=Object(o.c)((function(e){return e.onlineUsers.list}));return Object(r.useEffect)((function(){return re.connect((function(){return a(!1)}),(function(){return a(!0)})).catch((function(e){return console.log(e.message)})),re.on("connected",(function(t){var n=t.onlineUsers,r=t.lastsMessages;e({type:"GET_USERS",payload:{users:n}}),r.filter((function(e){return!e.read})).forEach((function(e){b._id!==e.author._id&&re.emit("read message",e._id)})),e({type:"GET_MESSAGES",payload:{messages:r}}),C.animateScroll.scrollToBottom({containerId:"chat"})})),re.on("new message",(function(t){e({type:"NEW_MESSAGE",payload:{message:t}}),C.animateScroll.scrollToBottom({containerId:"chat"}),b._id!==t.author._id&&re.emit("read message",t._id)})),re.on("new user",(function(t){return e({type:"NEW_USER",payload:{user:t}})})),re.on("read message",(function(t){return e({type:"READ_MESSAGE",payload:{messageId:t}})})),re.on("user exit",(function(t){return e({type:"LEAVE_USER",payload:{user:t}})})),function(){return re.disconnect()}}),[]),Object(_.jsxs)("div",{style:{display:"flex",height:"100%"},children:[Object(_.jsx)(S.a,{style:{flexGrow:0},children:Object(_.jsxs)($,{collapsible:!0,onCollapse:function(e){return l(e)},children:[Object(_.jsx)(w.a,{onClick:function(){e((function(e){e({type:j}),localStorage.clear()})),re.disconnect()},shape:"circle",icon:Object(_.jsx)(P.a,{}),style:ne.buttonInSideBar}),!u&&Object(_.jsx)(te,{level:5,style:ne.textInSideBar,children:"Online users:"}),Object(_.jsx)(E.b,{style:{paddingLeft:"20px"},split:!1,renderItem:function(e){return Object(_.jsx)(E.b.Item,{children:Object(_.jsx)(E.b.Item.Meta,{avatar:Object(_.jsx)(I.a,{style:{backgroundColor:"#87d068"},icon:Object(_.jsx)(L.a,{})}),title:!u&&Object(_.jsx)(ee,{style:ne.textInSideBar,strong:!0,children:e.name})})})},dataSource:O})]})}),Object(_.jsxs)(S.a,{style:{paddingLeft:"30px"},children:[Object(_.jsx)(X,{children:Object(_.jsx)(E.b,{id:"chat",style:{maxHeight:"85vh",overflowY:"scroll"},renderItem:function(e){return Object(_.jsx)(q,{date:e.date,video:e.video?e.video:null,author:e.author,content:e.content,read:e.read})},dataSource:d,locale:{emptyText:c?"Not connection":"Not messages"}})}),Object(_.jsx)(Z,{children:Object(_.jsx)(Q,{socket:re,disabledSend:c})})]})]})})),ae=n(348);var se=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.auth.token})),n=Object(o.c)((function(e){return e.auth.error}));return Object(_.jsxs)(S.a,{children:[Object(_.jsxs)(z.a,{name:"name",onFinish:function(t){var n=t.userName;e(function(e){return function(t){B(e).then((function(e){t({type:l,payload:{token:e.data.token,user:e.data.user}}),localStorage.setItem("Token",e.data.token),localStorage.setItem("User",JSON.stringify(e.data.user))}),(function(e){return t({type:"ERROR",payload:{error:e}})}))}}(n))},children:[Object(_.jsx)(z.a.Item,{label:"User name",name:"userName",children:Object(_.jsx)(Y.a,{})}),Object(_.jsx)(z.a.Item,{children:Object(_.jsx)(w.a,{type:"primary",htmlType:"submit",children:"Sing in"})})]}),n&&Object(_.jsx)(ae.a,{message:n.response.data.message,type:"error",showIcon:!0}),t&&Object(_.jsx)(y.a,{to:"/"})]})};n(339);var oe=function(){return Object(_.jsx)("div",{className:"app",children:Object(_.jsxs)(g.a,{basename:"/",children:[Object(_.jsx)(y.b,{exact:!0,path:"/",component:ce}),Object(_.jsx)(y.b,{path:"/login",component:se})]})})};s.a.render(Object(_.jsx)(c.a.StrictMode,{children:Object(_.jsx)(o.a,{store:x,children:Object(_.jsx)(oe,{})})}),document.getElementById("root"))}},[[340,1,2]]]);
//# sourceMappingURL=main.fb4969db.chunk.js.map